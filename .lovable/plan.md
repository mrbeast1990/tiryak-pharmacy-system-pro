
# ุฎุทุฉ ุจูุงุก ูุณู ุฅูุดุงุก ุงูุทูุจูุงุช ุงูุงุญุชุฑุงูู (Pro Order Builder)

## ูุธุฑุฉ ุนุงูุฉ
ุณูุชู ุฅูุดุงุก ูุณู ูุชูุงูู ููุนุงูุฌุฉ ุนุฑูุถ ุงูุฃุณุนุงุฑ ูู ุงูููุฑุฏูู ูุชุญููููุง ุฅูู ุทูุจูุงุช ุดุฑุงุก ุงุญุชุฑุงููุฉ ุจุชูุณูู PDF ุฌุงูุฒ ููุฅุฑุณุงู ุนุจุฑ ุงููุงุชุณุงุจ.

## ุงููููู ุงูุนุงู ูููููุงุช

```text
src/
โโโ components/
โ   โโโ order-builder/
โ       โโโ OrderBuilder.tsx           # ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
โ       โโโ FileUploader.tsx           # ุฑูุน ูููุงุช PDF ู Excel
โ       โโโ DataReviewDialog.tsx       # ูุฑุงุฌุนุฉ ุงูุจูุงูุงุช ุงููุณุชุฎุฑุฌุฉ
โ       โโโ ProductsTable.tsx          # ุฌุฏูู ุงูููุชุฌุงุช ุงูุชูุงุนูู
โ       โโโ ProductRow.tsx             # ุตู ุงูููุชุฌ ูุน ุฃุฒุฑุงุฑ ุงููููุฉ
โ       โโโ OrderSummary.tsx           # ููุฎุต ุงูุทูุจูุฉ
โ       โโโ SupplierSelector.tsx       # ุงุฎุชูุงุฑ ุงูููุฑุฏ
โโโ hooks/
โ   โโโ useOrderBuilder.ts             # ููุทู ุฅุฏุงุฑุฉ ุงูุทูุจูุฉ
โ   โโโ useOrderPDF.ts                 # ุชูููุฏ PDF ุงูุทูุจูุฉ
โโโ store/
    โโโ orderBuilderStore.ts           # ุญุงูุฉ ุงูุทูุจูุฉ (Zustand)
```

---

## ุงููุชุทูุจุงุช ูุงูุชูููุฐ ุงูุชูุตููู

### 1. ูุญุฑู ูุนุงูุฌุฉ ุงููููุงุช ุงููุชูุฏู (Advanced Parsing Engine)

#### ุฃ. ูููู ุฑูุน ุงููููุงุช `FileUploader.tsx`
- ุฏุนู ุฑูุน ูููุงุช PDF ู Excel (.xlsx, .xls, .csv)
- ูุงุฌูุฉ ุณุญุจ ูุฅููุงุช (Drag & Drop)
- ุนุฑุถ ุญุงูุฉ ุงูุชุญููู ูุงููุนุงูุฌุฉ

#### ุจ. ุฎูุงุฑุฒููุฉ ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ุงูุฐููุฉ

**ููููุงุช Excel:**
- ุงุณุชุฎุฏุงู ููุชุจุฉ `xlsx` ุงูููุฌูุฏุฉ
- ุงูุจุญุซ ุงูุชููุงุฆู ุนู ุตู ุงูุนูุงููู ุงูุฐู ูุญุชูู ุนูู ูููุงุช ููุชุงุญูุฉ

**ููููุงุช PDF:**
- ุงุณุชุฎุฏุงู Edge Function ุฌุฏูุฏุฉ `parse-supplier-quote`
- ุงูุงุณุชูุงุฏุฉ ูู AI ูุงุณุชุฎุฑุงุฌ ุงูุฌุฏุงูู ูู ูููุงุช PDF ุงููุนูุฏุฉ
- ุฅุฑุณุงู ุงูููู ูู base64 ูููุนุงูุฌุฉ

**ุงูุฃุนูุฏุฉ ุงููุทููุจุฉ:**
| ุงูุนููุฏ | ุงููููุงุช ุงูููุชุงุญูุฉ ุงูุจุฏููุฉ |
|--------|--------------------------|
| ุงุณู ุงูุตูู | ุงูุงุณูุ ุงูุตููุ ุงูููุชุฌุ trade_name |
| ุงูุณุนุฑ | ุณุนุฑ ุงููุญุฏุฉุ unit_priceุ price |
| ุชุงุฑูุฎ ุงูุตูุงุญูุฉ | ุงูุตูุงุญูุฉุ ุงูุชูุงุกุ expiry |

#### ุฌ. ูุงุฌูุฉ ุงููุฑุงุฌุนุฉ `DataReviewDialog.tsx`
- ุนุฑุถ ุงูุจูุงูุงุช ุงููุณุชุฎุฑุฌุฉ ูู ุฌุฏูู ูุงุจู ููุชุนุฏูู
- ุฅููุงููุฉ ุชุนุฏูู ุฃู ูููุฉ ูุจู ุงูููุงููุฉ
- ุฒุฑ "ููุงููุฉ" ูููู ุงูุจูุงูุงุช ููุฌุฏูู ุงูุฑุฆูุณู

---

### 2. ูุงุฌูุฉ ุงุฎุชูุงุฑ ุงูุฃุตูุงู ุงูุฐููุฉ (Selection UI)

#### ุฃ. ุฌุฏูู ุงูููุชุฌุงุช `ProductsTable.tsx`

```text
+------------------------------------------------------------------+
| ๐ ุจุญุซ ุณุฑูุน...                                                    |
+------------------------------------------------------------------+
| ุงูุตูู                    | ุงูุณุนุฑ    | ุงููููุฉ           | ุงูุฅุฌูุงูู |
+------------------------------------------------------------------+
| [ุตู ุนุงุฏู]                | 15.50    | [-] 0  [+] [___] | 0.00     |
| [ุตู ูุญุฏุฏ - ุฎูููุฉ ุฎุถุฑุงุก]  | 25.00    | [-] 5  [+] [___] | 125.00   |
+------------------------------------------------------------------+
```

**ุงููููุฒุงุช:**
- ุดุฑูุท ุจุญุซ ููุฑู ูููุชุฑ ุงูุฃุตูุงู
- ุฃุฒุฑุงุฑ (+) ู (-) ูุชุนุฏูู ุงููููุฉ
- ุญูู ุฅุฏุฎุงู ูุฏูู ูููููุฉ
- ุชูููุฒ ุงูุฃุตูุงู ุงููุญุฏุฏุฉ (ูููุฉ > 0) ุจุฎูููุฉ ุฎุถุฑุงุก ูุงุชุญุฉ
- ุงูุฅุฌูุงูู ุงููุฑุนู ูุญุณุจ ุชููุงุฆูุงู

#### ุจ. ุตู ุงูููุชุฌ `ProductRow.tsx`
- ุนุฑุถ ุงุณู ุงูุตูู ูุงูุณุนุฑ ูุชุงุฑูุฎ ุงูุตูุงุญูุฉ
- ุฃุฒุฑุงุฑ ุชุญูู ูู ุงููููุฉ
- ุชุฃุซูุฑ ุจุตุฑู ุนูุฏ ุงูุชุญุฏูุฏ

---

### 3. ููุงุนุฏ ุชุตุฏูุฑ ุงููุงุชูุฑุฉ (Smart Export Rules)

#### ุฃ. ูููู PDF ุงูุงุญุชุฑุงูู

```text
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        [ุดุนุงุฑ ุงูุตูุฏููุฉ]                        โ
โ                    ุตูุฏููุฉ ุงูุชุฑูุงู ุงูุดุงูู                      โ
โ                      ุทูุจ ูุงุชูุฑุฉ ุดุฑุงุก                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ  ุงูุดุฑูุฉ ุงูููุฑุฏุฉ: [ุงุณู ุงูุดุฑูุฉ]                                โ
โ  ุงูุชุงุฑูุฎ: [ุชุงุฑูุฎ ุงูููู]                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ  ุงูุตูู          โ ุงููููุฉ  โ ุงูุณุนุฑ    โ ุงูุฅุฌูุงูู              โ
โโโโโโโโโโโโโโโโโโโชโโโโโโโโโโชโโโโโโโโโโโชโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ  ุจุงุฑุงุณูุชุงููู   โ   10    โ  5.00    โ   50.00               โ
โ  ุฃูููุณูุณูููู  โ   20    โ  12.50   โ  250.00               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ                         ุงูุฅุฌูุงูู ุงูููู: 300.00 ุฏ.ู           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ  โ๏ธ ุงูุฑุฌุงุก ุงุฑุณุงู ูุณุฎู PDF ูู ุงููุงุชูุฑุฉ ุนูุฏ ุตุฏูุฑูุง           โ
โ     ูุจุงุดุฑุงู ุนุจุฑ ูุงุชุณ ุงุจ 0915938155                           โ
โ                                                              โ
โ  ๐ฑ 0915938155                                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

#### ุจ. ููุงุนุฏ ุงูุชุตุฏูุฑ ูู `useOrderPDF.ts`
- **ููุชุฑุฉ ุงููููุงุช ุงูุตูุฑูุฉ**: ูุชู ุงุณุชุจุนุงุฏ ุฃู ุตูู ูููุชู = 0
- **ุงูุชุฑููุณุฉ**: ุดุนุงุฑ ุงูุตูุฏููุฉ + ุงุณู "ุตูุฏููุฉ ุงูุชุฑูุงู ุงูุดุงูู" + "ุทูุจ ูุงุชูุฑุฉ ุดุฑุงุก"
- **ุงููุณุท**: ุงุณู ุงูุดุฑูุฉ + ุฌุฏูู (ุงูุตููุ ุงููููุฉุ ุงูุณุนุฑุ ุงูุฅุฌูุงูู)
- **ุงูุชุฐููู**: ุงูุฅุฌูุงูู ุงูููู ุจุฎุท ุนุฑูุถ + ููุงุญุธุฉ ูุงุชุณุงุจ ุจุงูููู ุงูุฃุญูุฑ

#### ุฌ. ุฎุท Amiri ููุนุฑุจูุฉ
- ุงุณุชุฎุฏุงู `addArabicFont` ุงูููุฌูุฏุฉ ูู `src/lib/pdf-utils.ts`
- ุงูุฎุท ููุฌูุฏ ุจุงููุนู ูู `/public/fonts/Amiri-Regular.ttf`

---

### 4. ูุดุงุฑูุฉ ุงููุงุชุณุงุจ

ุจุนุฏ ุชูููุฏ PDF:
- ุญูุธ ุงูููู ูุญููุงู (ุนูู ุงูุฌูุงู: Documentsุ ุนูู ุงูููุจ: ุชุญููู)
- ูุชุญ ุฑุงุจุท ูุงุชุณุงุจ ูุน ุฑูู ุงููุงุชู ุงููุญุฏุฏ
- ุงูุฑุณุงูุฉ: "ูุฑูู ุทูุจูุฉ ุดุฑุงุก ูู ุตูุฏููุฉ ุงูุชุฑูุงู ุงูุดุงูู"

```javascript
const whatsappUrl = `https://wa.me/218915938155?text=${encodeURIComponent(message)}`;
window.open(whatsappUrl, '_blank');
```

---

### 5. ุชุญุฏูุซุงุช ูุงุฌูุฉ ุงููุณุชุฎุฏู

#### ุฃ. ุฅุถุงูุฉ ุจุทุงูุฉ ูู Dashboard
```typescript
// src/components/dashboard/ActionCards.tsx
{
  id: 'order-builder',
  title: 'ุฅูุดุงุก ุงูุทูุจูุงุช',
  description: 'ุชุญููู ุนุฑูุถ ุงูุฃุณุนุงุฑ ุฅูู ุทูุจูุงุช ุดุฑุงุก',
  icon: ShoppingCart,
  iconBg: 'bg-indigo-100',
  iconColor: 'text-indigo-600',
  show: user?.role === 'admin' || user?.role === 'ahmad_rajili',
  onClick: () => onNavigate('order-builder'),
}
```

#### ุจ. ุงูุชููู ูู Dashboard.tsx
```typescript
if (currentPage === 'order-builder') {
  return <OrderBuilder onBack={handleBack} />;
}
```

---

## ุงููููุฉ ุงูุจุตุฑูุฉ

| ุงูุนูุตุฑ | ุงููููุฉ |
|--------|--------|
| ุงูููู ุงูุฃุณุงุณู | ุงูุฃุฎุถุฑ ุงูุทุจู (#10b981) |
| ุงูููู ุงูุซุงููู | ุงูุฃุจูุถ |
| ุงูุฎุท | Cairo (ููุฌูุฏ ูู CSS) |
| ุงูุดุนุงุฑ | `/lovable-uploads/e077b2e2-5bf4-4f3c-b603-29c91f59991e.png` |

---

## ููุฎุต ุงููููุงุช ุงููุทููุจ ุฅูุดุงุคูุง

| ุงูููู | ุงููุตู |
|-------|-------|
| `src/components/order-builder/OrderBuilder.tsx` | ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ |
| `src/components/order-builder/FileUploader.tsx` | ุฑูุน ุงููููุงุช |
| `src/components/order-builder/DataReviewDialog.tsx` | ูุฑุงุฌุนุฉ ุงูุจูุงูุงุช |
| `src/components/order-builder/ProductsTable.tsx` | ุฌุฏูู ุงูููุชุฌุงุช |
| `src/components/order-builder/ProductRow.tsx` | ุตู ุงูููุชุฌ |
| `src/components/order-builder/OrderSummary.tsx` | ููุฎุต ุงูุทูุจูุฉ |
| `src/components/order-builder/SupplierSelector.tsx` | ุงุฎุชูุงุฑ ุงูููุฑุฏ |
| `src/hooks/useOrderPDF.ts` | ุชูููุฏ PDF |
| `src/store/orderBuilderStore.ts` | ุฅุฏุงุฑุฉ ุงูุญุงูุฉ |
| `supabase/functions/parse-supplier-quote/index.ts` | ูุนุงูุฌุฉ PDF ุจุงูู AI |

---

## ููุงุญุธุงุช ุชูููุฉ

1. **ูุนุงูุฌุฉ PDF**: ุณูุชู ุฅูุดุงุก Edge Function ุชุณุชุฎุฏู ุฎุฏูุฉ AI ูุงุณุชุฎุฑุงุฌ ุงูุฌุฏุงูู ูู ูููุงุช PDF ุงููุนูุฏุฉ. ูุฏ ุชุญุชุงุฌ ูููุชุงุญ OpenAI ุฃู Anthropic.

2. **ุงูุฎุท ุงูุนุฑุจู**: ุณูุชู ุงุณุชุฎุฏุงู ุฎุท Amiri ุงูููุฌูุฏ ุจุงููุนู ูุถูุงู ุฏุนู ุงููุบุฉ ุงูุนุฑุจูุฉ ูู PDF.

3. **ุงูุชุฎุฒูู ุงููุญูู**: ูุง ุญุงุฌุฉ ูุฌุฏุงูู ูุงุนุฏุฉ ุจูุงูุงุช ุฌุฏูุฏุฉ - ุงูุทูุจูุงุช ูุคูุชุฉ ูุชูุตุฏููุฑ ููุท ูู PDF.

4. **ุงูุชูุงูู**: ูุนูู ุนูู ุงูููุจ ูุงูุฌูุงู ุจุงุณุชุฎุฏุงู `usePDFExport` ุงูููุฌูุฏ.
