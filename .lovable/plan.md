

# إصلاح مشاكل الأولوية + تحسين كرت الصنف

## المشاكل المكتشفة

### 1. الأولوية لا تُحفظ عند الإضافة (Bug)
في `pharmacyStore.ts`، دالة `addMedicine` تتجاهل قيمة `repeat_count` المرسلة من الحوار:
- عند إضافة صنف جديد (سطر 182): يتم تعيين `repeat_count: 1` دائما بغض النظر عن الأولوية المختارة
- عند وجود صنف بنفس الحالة (سطر 112): يتم زيادة العدد تلقائيا بدلا من استخدام الأولوية المختارة
- السبب: تعريف الدالة `addMedicine` يقبل فقط `Pick<Medicine, 'name' | 'status' | 'notes'>` ولا يشمل `repeat_count`

### 2. لا يوجد خيار "حسب الأولوية" في قائمة الترتيب
قائمة الترتيب تحتوي على: الاسم، التاريخ، التكرار - لكن لا يوجد خيار مخصص للأولوية (التكرار والأولوية نفس الحقل لكن المسمى غير واضح)

### 3. لون الأولوية يظهر فقط كشريط رفيع 4px
المستخدم يريد أن يكون لون الأولوية على الكرت كاملا (خلفية الكرت) وليس فقط الشريط الجانبي

---

## التعديلات المطلوبة

### الملف 1: `src/store/pharmacyStore.ts`
- تعديل تعريف `addMedicine` ليقبل `repeat_count` كمعامل اختياري
- عند إضافة صنف جديد: استخدام `repeat_count` المرسل من الحوار (أو 1 كقيمة افتراضية)
- عند وجود صنف بنفس الحالة (shortage): استخدام الأولوية المختارة بدلا من الزيادة التلقائية

### الملف 2: `src/components/ShortageManager.tsx`
- تغيير خيار "التكرار" في قائمة الترتيب إلى "الأولوية" مع إبقاء نفس المنطق (الترتيب حسب `repeat_count`)

### الملف 3: `src/components/shortage/SwipeableMedicineCard.tsx`
- تطبيق لون خلفية الكرت كاملا حسب الأولوية بدلا من الشريط الرفيع فقط:
  - عادي (1): خلفية خضراء فاتحة `bg-emerald-50 border-emerald-200`
  - متوسط (2): خلفية برتقالية فاتحة `bg-amber-50 border-amber-200`
  - عالي (3): خلفية حمراء فاتحة `bg-red-50 border-red-200`
- إبقاء الشريط الجانبي الرفيع كتأكيد بصري إضافي

---

## الملفات المتأثرة

| الملف | التعديل |
|-------|---------|
| `src/store/pharmacyStore.ts` | إصلاح حفظ الأولوية عند الإضافة |
| `src/components/ShortageManager.tsx` | تغيير مسمى "التكرار" إلى "الأولوية" |
| `src/components/shortage/SwipeableMedicineCard.tsx` | تلوين خلفية الكرت كاملا حسب الأولوية |

