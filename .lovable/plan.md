

# خطة التحديث الشامل لجدول الطلبيات وتصدير PDF

## نظرة عامة
سيتم تحسين تجربة المستخدم على الهواتف مع تحديث شامل لتنسيق PDF ليكون احترافياً ومتوافقاً مع طلبات الموردين.

---

## 1. تحسين تجربة الجوال (Mobile UX Enhancements)

### أ. التمرير الأفقي للجدول (`ProductsTable.tsx`)
```text
الحالي: جدول ثابت → يقص الأعمدة على الشاشات الصغيرة
الجديد: overflow-x: auto → تمرير أفقي سلس
```

**التغييرات:**
- تحويل الـ Grid إلى جدول HTML حقيقي مع `<table>`
- إضافة container بـ `overflow-x: auto`
- تحديد عرض أدنى للجدول (min-width: 600px)

### ب. عمود ITEM DESCRIPTION ثابت (Sticky Column)
```css
.sticky-column {
  position: sticky;
  left: 0;
  z-index: 10;
  background: inherit;
  box-shadow: 2px 0 5px rgba(0,0,0,0.1);
}
```

### ج. التفاف النصوص الطويلة
```text
الحالي: truncate → يقطع الاسم الطويل
الجديد: line-clamp-2 → سطرين كحد أقصى مع ...
```

---

## 2. ترتيب الأعمدة الجديد (LTR)

| العمود | العرض | المحاذاة |
|--------|-------|----------|
| NO | 40px | يسار |
| CODE | 80px | وسط |
| ITEM DESCRIPTION | مرن (sticky) | يسار |
| EXP | 90px | وسط |
| PRICE | 70px | وسط |
| الكمية | 100px | وسط |
| T.PRICE | 80px | وسط |

---

## 3. تحديثات PDF (`useOrderPDF.ts`)

### أ. ترتيب الأعمدة الجديد
```typescript
head: [['NO', 'CODE', 'ITEM DESCRIPTION', 'EXP', 'PRICE', 'T.PRICE']]
```

### ب. توزيع المساحات المحسّن
```typescript
columnStyles: {
  0: { cellWidth: 10 },     // NO (~5%)
  1: { cellWidth: 18 },     // CODE (~10%)
  2: { cellWidth: 'auto' }, // ITEM DESCRIPTION (~55%)
  3: { cellWidth: 20 },     // EXP (~10%)
  4: { cellWidth: 18 },     // PRICE (~10%)
  5: { cellWidth: 20 },     // T.PRICE (~10%)
}
```

### ج. موضع الملاحظة الحمراء
```text
الحالي: أسفل الصفحة (footerY = pageHeight - 25)
الجديد: أسفل الجدول مباشرة (finalY + 20)
```

**التنسيق الجديد:**
```typescript
// بعد جدول الإجمالي مباشرة
yPos = finalY + 25;

doc.setFontSize(10);
doc.setTextColor(220, 38, 38); // أحمر
doc.setFont('Amiri', 'bold');

// سطر واحد LTR
const noteText = '0915938155  الرجاء ارسال نسخه PDF من الفاتورة عند صدورها مباشراً عبر واتس اب';
doc.text(noteText, margin, yPos, { align: 'left' });
```

### د. دعم Letterhead (جاهز للمستقبل)
```typescript
// إذا كان هناك ملف letterhead، أضفه كخلفية
const letterheadPath = '/lovable-uploads/letterhead.png';
if (await checkFileExists(letterheadPath)) {
  doc.addImage(letterhead, 'PNG', 0, 0, pageWidth, pageHeight);
}
```

---

## 4. ملخص الملفات المتأثرة

| الملف | نوع التعديل |
|-------|-------------|
| `src/components/order-builder/ProductsTable.tsx` | تحويل لجدول HTML + sticky + scroll |
| `src/components/order-builder/ProductRow.tsx` | تحويل لـ `<tr>` + إعادة ترتيب الأعمدة |
| `src/hooks/useOrderPDF.ts` | ترتيب أعمدة + توزيع مساحات + موضع ملاحظة |

---

## 5. هيكل الجدول الجديد (UI)

```text
┌──────┬───────────────────────────────────┬────────┬────────┬────────┬────────────┬──────────┐
│  NO  │      ITEM DESCRIPTION (sticky)    │  CODE  │  EXP   │ PRICE  │   الكمية    │ T.PRICE  │
├──────┼───────────────────────────────────┼────────┼────────┼────────┼────────────┼──────────┤
│  1   │ Paracetamol 500mg Tablets         │ PAR001 │ 12/25  │ 5.50   │ [-] 10 [+] │  55.00   │
│      │ (يتمدد لسطرين إذا كان طويلاً)      │        │        │        │            │          │
├──────┼───────────────────────────────────┼────────┼────────┼────────┼────────────┼──────────┤
│  2   │ Amoxicillin 250mg/5ml Susp...     │ AMX002 │ 06/25  │ 12.00  │ [-] 0  [+] │   0.00   │
└──────┴───────────────────────────────────┴────────┴────────┴────────┴────────────┴──────────┘
                                                                              ← التمرير الأفقي
```

---

## 6. هيكل PDF النهائي

```text
┌─────────────────────────────────────────────────────────────────┐
│                        [شعار الصيدلية]                          │
│                    صيدلية الترياق الشافي                        │
│                      طلب فاتورة شراء                            │
│                                                                 │
│  الشركة الموردة: [اسم الشركة]           التاريخ: [التاريخ]      │
├─────────────────────────────────────────────────────────────────┤
│ NO │ CODE  │     ITEM DESCRIPTION     │ EXP  │ PRICE │ T.PRICE │
├────┼───────┼──────────────────────────┼──────┼───────┼─────────┤
│ 1  │PAR001 │ Paracetamol 500mg        │12/25 │ 5.50  │  55.00  │
│ 2  │AMX002 │ Amoxicillin 250mg Susp   │06/25 │ 12.00 │ 120.00  │
├─────────────────────────────────────────────────────────────────┤
│                    الإجمالي الكلي: 175.00 د.ل                    │
├─────────────────────────────────────────────────────────────────┤
│ 0915938155  الرجاء ارسال نسخه PDF من الفاتورة عند صدورها       │
│             مباشراً عبر واتس اب                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## ملاحظات تقنية

1. **الخط العربي**: سيستمر استخدام خط Amiri الموجود لدعم النص العربي في الملاحظة

2. **Letterhead**: جاهز للإضافة عند رفع الملف - سيتم استخدامه كخلفية تلقائياً

3. **arabic-reshaper**: هذه المكتبة لـ Python ولا تتوفر لـ JavaScript/TypeScript. سنعتمد على خط Amiri الذي يدعم الحروف المتصلة بشكل صحيح

4. **الأداء**: سيتم تحسين الجدول باستخدام `useMemo` لتجنب إعادة الحسابات

