
# ุฎุทุฉ ุฅูุดุงุก ูุณุงุนุฏ ุงูุชุฑูุงู ุงูุฐูู ููุชุญูููุงุช ุงููุงููุฉ (AI Tiryak Admin Assistant)

## ูุธุฑุฉ ุนุงูุฉ
ุณูุชู ุฅูุดุงุก ูุณุงุนุฏ ุฐูู ุฎุงุต ุจุงููุณุคูููู (Admin) ูุชุญููู ุงูุจูุงูุงุช ุงููุงููุฉ ูุงูุชุดุบูููุฉ ููุตูุฏููุฉ. ูุธูุฑ ูุฒุฑ ุนุงุฆู ูู ุฒุงููุฉ ุงูุดุงุดุฉ ูููุชุญ ูุงูุฐุฉ ุฏุฑุฏุดุฉ ุฌุงูุจูุฉ (Sheet/Sidebar).

---

## 1. ุงูุชุญูู ูู ุงูููุฒุงุช ุงูุญุงููุฉ (โ ุชู ุงูุชุฃูุฏ)

| ุงูููุฒุฉ | ุงูุญุงูุฉ | ุงูููู |
|--------|--------|-------|
| ุนุฑุถ ุงูุงุณู ุงูุนููู ุชุญุช ุงุณู ุงูุฏูุงุก | โ ูุนูู | `SwipeableMedicineCard.tsx` (ุณุทุฑ 190-194) |
| ุงูุชุฑุงุญุงุช ุชููุงุฆูุฉ ููุฃุณูุงุก ุงูุนูููุฉ | โ ูุนูู | `suggestionsStore.ts` + `AddMedicineDialog.tsx` |

---

## 2. ูููู ุงููุณุงุนุฏ ุงูุฐูู ุงูุฌุฏูุฏ

### ุฃ. ุงูุฒุฑ ุงูุนุงุฆู (Floating Action Button)

```text
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                โ
โ                         ุตูุญุฉ ุงูุชุทุจูู                           โ
โ                                                                โ
โ                                                         โโโโโโ โ
โ                                                         โ ๐ค โ โ  โ ุฒุฑ ุนุงุฆู
โ                                                         โโโโโโ โ     (admin ููุท)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ุงูููุงุตูุงุช:**
- ูุธูุฑ ููุท ูููุณุชุฎุฏููู ุจุตูุงุญูุฉ `admin` ุฃู `ahmad_rajili`
- ูููุน ุซุงุจุช: ุฃุณูู ูุณุงุฑ ุงูุดุงุดุฉ (RTL = ุฃุณูู ูููู)
- ุชุตููู: ุฏุงุฆุฑูุ ุฎูููุฉ Emerald-600ุ ุฃููููุฉ Bot
- ุนูุฏ ุงูุถุบุท: ููุชุญ Sheet ุฌุงูุจูุฉ

### ุจ. ูุงูุฐุฉ ุงูุฏุฑุฏุดุฉ ุงูุฌุงูุจูุฉ (Sheet)

```text
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ ูุณุงุนุฏ ุงูุชุฑูุงู ุงูุชุญูููู                                    [X]  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  ๐ค ูุฑุญุจุงู! ุฃูุง ูุณุงุนุฏู ุงูุชุญูููู. ูููููู ูุณุงุนุฏุชู ูู:         โ โ
โ  โ                                                                โ โ
โ  โ  โข ุชุญููู ุงูุฃุฑุจุงุญ ูุงูุฎุณุงุฆุฑ                                    โ โ
โ  โ  โข ูุดู ุงูุฎูู ุงููุงูู                                          โ โ
โ  โ  โข ุชุญููู ุฃููุงุท ุงูููุงูุต ุงููุชูุฑุฑุฉ                              โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ ๐ ุชุญููู ุงูุฃุฑุจุงุญ ููุฐุง ุงูุดูุฑ                                  โ โ
โ  โ โ๏ธ ูุดู ุงูุฎูู ูู ุงููุตุงุฑูู                                     โ โ
โ  โ ๐ ุชุญููู ุงูููุงูุต ุงููุชูุฑุฑุฉ                                    โ โ
โ  โ ๐ ููุฎุต ูุงูู ุดุงูู                                            โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโ                   โ
โ  โ ุงุณุฃู ุนู ุฃู ุชุญููู...               โ  โ โค  โ                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโ                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## 3. Edge Function ุงูุฌุฏูุฏุฉ: `tiryak-analytics-ai`

### ุงูุจูุงูุงุช ุงูุชู ุณูุชู ุฌูุจูุง (Snapshot):

| ุงูุฌุฏูู | ุงูุจูุงูุงุช ุงููุทููุจุฉ | ุงูุบุฑุถ |
|--------|-------------------|-------|
| `revenues` | ุฌููุน ุงูุณุฌูุงุช | ุญุณุงุจ ุฅุฌูุงูู ุงููุจูุนุงุช |
| `expenses` | ุฌููุน ุงูุณุฌูุงุช | ุญุณุงุจ ุฅุฌูุงูู ุงููุตุงุฑูู |
| `payments` | ุฌููุน ุงูุณุฌูุงุช | ุญุณุงุจ ุงูุณุฏุงุฏุงุช ููุดุฑูุงุช |
| `medicines` | ุงูุฃุตูุงู ุจุญุงูุฉ shortage | ุชุญููู ุงูููุงูุต ุงููุชูุฑุฑุฉ |

### System Prompt ุงููุชุฎุตุต:

```
ุฃูุช "ูุณุงุนุฏ ุงูุชุฑูุงู ุงูุชุญูููู" ูุตูุฏููุฉ ุงูุชุฑูุงู ุงูุดุงูู.
ูููุชู: ุชุญููู ุงูุจูุงูุงุช ุงููุงููุฉ ูุงูุชุดุบูููุฉ ููุณุงุนุฏุฉ ุงููุฏูุฑ ูู ุงุชุฎุงุฐ ุงููุฑุงุฑุงุช.

## ุงูููุงู ุงููุชุงุญุฉ:

### 1. ุชุญููู ุงูุฃุฑุจุงุญ ๐
ุตุงูู ุงูุฑุจุญ = ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช (revenues.income) - ุงููุตุงุฑูู (expenses) - ุงูุณุฏุงุฏุงุช (payments)

### 2. ูุดู ุงูุฎูู ุงููุงูู โ๏ธ
- ูุงุฑู ูุตุงุฑูู ุงูุดูุฑ ุงูุญุงูู ุจูุชูุณุท ุงูุฃุดูุฑ ุงูุซูุงุซุฉ ุงูุณุงุจูุฉ
- ุฅุฐุง ุชุฌุงูุฒุช 30%: ุชูุจูู ุจุฑุชูุงูู
- ุฅุฐุง ุชุฌุงูุฒุช 50%: ุชูุจูู ุฃุญูุฑ

### 3. ูุดู ุงูุชูุฑุงุฑ ูู ุงูููุงูุต ๐
- ุงูุฃุตูุงู ุงูุชู ุณุฌูุช ูููุต ุฃูุซุฑ ูู 3 ูุฑุงุช (repeat_count >= 3)
- ุชุญููู: ูู ููุฌุฏ ุฎูู ูู ุงูุชูุฑูุฏ ุฃู ุงุณุชููุงู ุบูุฑ ุนุงุฏูุ

### 4. ููุฎุต ูุงูู ุดุงูู ๐
- ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช ุงูููู/ุงูุฃุณุจูุน/ุงูุดูุฑ
- ุฅุฌูุงูู ุงููุตุงุฑูู
- ุตุงูู ุงูุฑุจุญ
- ุฃูุจุฑ 5 ูุตุงุฑูู
- ุญุงูุฉ ุงูููุงูุต
```

---

## 4. ุงููููุงุช ุงูุฌุฏูุฏุฉ ูุงูุชุนุฏููุงุช

### ุฃ. ูููุงุช ุฌุฏูุฏุฉ:

| ุงูููู | ุงููุตู |
|-------|-------|
| `src/components/AdminAIAssistant.tsx` | ุงููููู ุงูุฑุฆูุณู (ุงูุฒุฑ ุงูุนุงุฆู + Sheet) |
| `supabase/functions/tiryak-analytics-ai/index.ts` | Edge Function ููุชุญูููุงุช |

### ุจ. ูููุงุช ููุนุฏููุฉ:

| ุงูููู | ุงูุชุนุฏูู |
|-------|--------|
| `src/components/Dashboard.tsx` | ุฅุถุงูุฉ `AdminAIAssistant` |

---

## 5. ุงูุชุตููู ุงูุชููู ูููููู

### `AdminAIAssistant.tsx`:

```typescript
// ุงููููู ุงูุนุงู
- ูุณุชุฎุฏู useAuthStore ููุชุญูู ูู ุงูุตูุงุญูุงุช
- ูุณุชุฎุฏู Sheet ูู Radix UI ูููุงูุฐุฉ ุงูุฌุงูุจูุฉ
- ูุณุชุฎุฏู ููุณ ููุทู streamChat ูู AIConsultant
- ูุนุฑุถ ุงูุฒุฑ ุงูุนุงุฆู ููุท ุฅุฐุง user.role === 'admin' || user.role === 'ahmad_rajili'
```

### Flow:

```
1. ุงููุณุชุฎุฏู ูุถุบุท ุนูู ุงูุฒุฑ ุงูุนุงุฆู
2. ุชูุชุญ Sheet ุฌุงูุจูุฉ
3. ุนูุฏ ุฃูู ุฑุณุงูุฉ: ูุชู ุฌูุจ Snapshot ุงูุจูุงูุงุช
4. ุงูู AI ูุญูู ุงูุจูุงูุงุช ููุฑุฏ ุจุงูุชุญููู
5. ุงููุญุงุฏุซุฉ ูุณุชูุฑุฉ ุฏุงุฎู ุงูู Sheet
```

---

## 6. ุงูุชุญูู ูู ุงูุตูุงุญูุงุช (RBAC)

### ุงูุชุญูู ูู ุงูู Frontend:

```typescript
const { user } = useAuthStore();
const isAdmin = user?.role === 'admin' || user?.role === 'ahmad_rajili';

if (!isAdmin) return null; // ูุง ูุธูุฑ ุงูุฒุฑ
```

### ุงูุชุญูู ูู Edge Function:

```typescript
// ุงุณุชุฎุฏุงู auth.getClaims ููุชุญูู ูู ุตูุงุญูุฉ ุงููุณุชุฎุฏู
const { data: { claims } } = await supabase.auth.getClaims(token);
const userRole = claims?.user_metadata?.role;

if (!['admin', 'ahmad_rajili'].includes(userRole)) {
  return new Response(JSON.stringify({ error: 'ุบูุฑ ูุตุฑุญ' }), { status: 403 });
}
```

---

## 7. ุงููููุฉ ุงูุจุตุฑูุฉ

| ุงูุนูุตุฑ | ุงูุชุตููู |
|--------|---------|
| ุงูุฒุฑ ุงูุนุงุฆู | `bg-emerald-600 hover:bg-emerald-700` ูุน ุฃููููุฉ `BarChart3` |
| ุงูู Sheet | ุฎูููุฉ ุจูุถุงุกุ header ุจู gradient emerald |
| ุงูุฎุท | Cairo (ููุฌูุฏ ุจุงููุนู) |
| ุงูุฃููููุงุช | lucide-react: `BarChart3`, `TrendingUp`, `AlertTriangle`, `RefreshCw` |

---

## 8. ุงูุฃุณุฆูุฉ ุงูููุชุฑุญุฉ (Quick Actions)

```typescript
const suggestedQuestions = [
  { icon: TrendingUp, text: 'ูุง ุตุงูู ุงูุฑุจุญ ููุฐุง ุงูุดูุฑุ' },
  { icon: AlertTriangle, text: 'ูู ููุฌุฏ ุฎูู ูู ุงููุตุงุฑููุ' },
  { icon: RefreshCw, text: 'ูุง ุงูุฃุตูุงู ุงููุชูุฑุฑุฉ ูู ุงูููุงูุตุ' },
  { icon: BarChart3, text: 'ุฃุนุทูู ููุฎุตุงู ูุงููุงู ุดุงููุงู' },
];
```

---

## 9. ููุฎุต ุงููููุงุช

| ุงูููู | ุงูุนูููุฉ | ุงููุตู |
|-------|---------|-------|
| `src/components/AdminAIAssistant.tsx` | **ุฅูุดุงุก** | ุงูุฒุฑ ุงูุนุงุฆู + Sheet + ุฏุฑุฏุดุฉ |
| `src/components/Dashboard.tsx` | **ุชุนุฏูู** | ุฅุถุงูุฉ ุงููููู ุงูุฌุฏูุฏ |
| `supabase/functions/tiryak-analytics-ai/index.ts` | **ุฅูุดุงุก** | Edge Function ููุชุญูููุงุช |
| `supabase/config.toml` | **ุชุนุฏูู** | ุฅุถุงูุฉ ุงูู function ุงูุฌุฏูุฏุฉ |

---

## 10. ูุซุงู ุนูู ุชุญููู AI

**ุณุคุงู:** "ูุง ุตุงูู ุงูุฑุจุญ ููุฐุง ุงูุดูุฑุ"

**ุฑุฏ AI:**
```
๐ ุงูุชุญููู ุงููุงูู ูุดูุฑ ูุจุฑุงูุฑ 2026

๐ฐ ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช: 45,230 ุฏ.ู
๐ ุฅุฌูุงูู ุงููุตุงุฑูู: 12,500 ุฏ.ู
๐ฆ ุงูุณุฏุงุฏุงุช ููุดุฑูุงุช: 18,000 ุฏ.ู

โโโโโโโโโโโโโโโโโโโ
๐ ุตุงูู ุงูุฑุจุญ: 14,730 ุฏ.ู
โโโโโโโโโโโโโโโโโโโ

โ๏ธ ููุงุญุธุฉ: ุงููุตุงุฑูู ูุฐุง ุงูุดูุฑ ุฃุนูู ุจู 15% ูู ุงูุดูุฑ ุงูุณุงุจู.
ุฃูุจุฑ ูุตุฑูู: ุฅูุฌุงุฑ ุงููุญู (5,000 ุฏ.ู)
```

---

## 11. ุงูุฃูุงู

- โ ุงูุชุญูู ูู ุงูุตูุงุญูุงุช ูู Frontend (ูุง ูุธูุฑ ุงูุฒุฑ ูููุณุชุฎุฏููู ุงูุนุงุฏููู)
- โ ุงูุชุญูู ูู ุงูุตูุงุญูุงุช ูู Edge Function (ูุฑูุถ ุงูุทูุจุงุช ูู ุบูุฑ ุงููุณุคูููู)
- โ ุงุณุชุฎุฏุงู Service Role Key ููุท ูู Edge Function ูุฌูุจ ุงูุจูุงูุงุช
- โ ูุง ูุชู ุชุฎุฒูู ุงููุญุงุฏุซุงุช ุงูุชุญููููุฉ (ุชุฎุชูู ุนูุฏ ุฅุบูุงู ุงูู Sheet)
